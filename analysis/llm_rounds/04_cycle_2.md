# 一种双数据源工业波形数据处理方法及系统

## 摘要
本发明涉及工业波形数据处理技术领域，公开一种双数据源工业数据处理方法及系统。该方法将文件数据源与网络数据源统一接入，对元数据、波形数据和日志数据进行统一建模，并按主题shot-metadata、wave-data、operation-log、plc-interlock进行异步路由消费。结构化数据写入关系型数据库，时序采样数据写入时序数据库，通过接口提供查询、同步与状态反馈，并向前端推送实时处理结果，从而提升多源一致性、容错能力和查询效率。

## 权利要求书
1. 一种应用于工业波形数据处理技术领域的工业数据处理方法，其特征在于，包括：接收来自文件数据源和网络数据源的工业数据；对工业数据进行字段映射和统一建模；按照数据类型将统一数据发送至消息中间件主题；由消费端执行幂等处理并分层存储；通过服务接口返回查询结果和同步状态。
2. 根据权利要求1所述的方法，其特征在于，所述文件数据源用于读取TDMS波形文件、操作日志文件和互锁日志文件，所述网络数据源用于接收流式数据。
3. 根据权利要求1所述的方法，其特征在于，所述统一建模至少包括时间戳字段、业务主键字段、通道字段、数据类型字段和数值字段。
4. 根据权利要求1所述的方法，其特征在于，所述消息中间件主题至少包括shot-metadata、wave-data、operation-log、plc-interlock。
5. 根据权利要求1所述的方法，其特征在于，消费端执行主键去重、失败重试和异常记录，以保证幂等写入。
6. 根据权利要求1所述的方法，其特征在于，结构化数据写入关系型数据库，时序采样数据写入时序数据库。
7. 根据权利要求1所述的方法，其特征在于，同步触发至少包括单任务同步、批量同步和全量同步。
8. 根据权利要求1所述的方法，其特征在于，状态查询返回任务状态、处理条数、失败条数和错误信息。
9. 根据权利要求1所述的方法，其特征在于，主数据源不可用时自动切换至备用数据源，并在主数据源恢复后执行回退切换。
10. 根据权利要求1所述的方法，其特征在于，处理结果通过实时推送通道向前端输出进度事件与结果事件。
11. 一种工业数据处理系统，其特征在于，包括数据接入模块、标准化建模模块、消息路由模块、消费存储模块、接口服务模块、主备切换模块、实时推送模块，所述模块协同执行权利要求1所述方法。
12. 根据权利要求11所述的系统，其特征在于，数据接入模块包括文件读取单元和网络接收单元。
13. 根据权利要求11所述的系统，其特征在于，消费存储模块包括关系型持久化单元和时序持久化单元。
14. 根据权利要求11所述的系统，其特征在于，接口服务模块至少包括数据源直读接口、同步触发接口和混合查询接口。
15. 一种计算机设备，其特征在于，包括处理器和存储器，所述存储器存储有程序，所述程序被所述处理器执行时实现权利要求1-8任一项所述的方法。
16. 一种计算机可读存储介质，其上存储有程序，所述程序被处理器执行时实现权利要求1-8任一项所述的方法。
17. 一种计算机程序产品，其特征在于，包括程序指令，所述程序指令被处理器执行时实现权利要求1-8任一项所述的方法。
18. 根据权利要求1所述的方法，其特征在于，增加运行监测步骤并输出链路性能指标。

## 说明书
### 技术领域
[0001] 本发明涉及工业波形数据处理技术领域，尤其涉及一种面向离线文件与在线流式并存场景的双数据源工业数据处理方法及系统。
### 背景技术
[0002] 现有工业系统在离线文件与在线流式并存场景下通常采用双链路并行实现，导致模型与字段口径不统一。
[0003] 传统实现中接入、处理、存储、查询耦合度高，新增能力时需要多模块同步改造。
[0004] 单一数据库难以同时满足结构化检索和高频时序读写需求，系统扩展性受限。
[0005] 主链路异常缺少标准化切换与恢复回退时，系统连续服务能力不足。
### 发明内容
[0006] 本发明要解决的技术问题是：在双数据源并存条件下实现统一建模、异步解耦、分层存储和连续服务。
[0007] 本发明采用统一数据对象承载各类工业数据，并通过消息中间件主题进行分类路由。
[0008] 消费端执行幂等处理后将结构化数据写入关系型数据库、将时序数据写入时序数据库。
[0009] 系统提供接口能力，接口样例包括：GET /api/data/channels；GET /api/data/import/file/available；GET /api/data/receive/status；GET /api/data/shots；GET /api/data/shots/{shotNo}/channels；GET /api/data/shots/{shotNo}/complete。
[0010] 通过状态反馈与实时推送机制形成处理闭环。
[0011] 与现有技术相比，本发明降低跨源语义偏差，提升链路可扩展性和故障恢复能力。
### 附图说明
[0012] 图1为系统总体架构图。
[0013] 图2为处理流程图。
[0014] 图3为模块关系图。
### 具体实施方式
[0015] 实施例中，核心处理类包括：DataConsumer、DataPipelineService、DataProducer、FileDataSource、InfluxDBService、KafkaController、NetworkDataSource、WebSocketController。
[0016] 统一对象对应实体至少包括：ChannelEntity、OperationLogEntity、PlcInterlockEntity、ShotMetadataEntity、WaveDataEntity。
[0017] 文件源读取离线采样文件与日志文件，网络源接收流式输入数据。
[0018] 标准化模块执行字段映射，统一时间戳、主键、通道、数据类型和数值字段定义。
[0019] 消息路由模块将数据分发至主题：shot-metadata、wave-data、operation-log、plc-interlock。
[0020] 消费模块执行去重、重试和异常记录策略，以保证幂等写入。
[0021] 持久化模块将结构化信息保存至关系型数据库，将时序采样点保存至时序数据库。
[0022] 接口服务模块提供数据源直读、同步触发、数据库查询和混合查询能力。
[0023] 状态接口返回任务状态、处理数量、失败数量和错误原因。
[0024] 主备切换模块周期检测主数据源可用性。
[0025] 当主数据源异常时切换备用数据源并维持接口连续输出。
[0026] 主数据源恢复后执行回退切换并记录切换事件。
[0027] 实时推送模块向前端发送进度与结果事件，实现可视化实时更新。
[0028] 系统可通过定时任务触发同步与维护流程，提升运行稳定性。
[0029] 在不偏离本发明构思前提下，等效消息平台、数据库和通信协议替换均落入保护范围。

