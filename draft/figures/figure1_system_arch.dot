
digraph G {
  graph [rankdir=TB, splines=ortho, bgcolor=white, fontname="SimSun",
         nodesep=0.40, ranksep=0.62, pad=0.16,
         size="6.69,9.65", ratio=compress, margin=0.02];
  node  [shape=box, style="solid", color=black, penwidth=2.0,
         fontname="SimSun", fontsize=14, margin="0.10,0.08"];
  edge  [color=black, arrowsize=0.75, penwidth=2.0, arrowhead=normal];
  l1 [shape=plaintext, fontsize=13, label="采集层"];
  l2 [shape=plaintext, fontsize=13, label="消息层"];
  l3 [shape=plaintext, fontsize=13, label="持久化层"];
  l4 [shape=plaintext, fontsize=13, label="服务与展示层"];

  layer_w1 [label="", shape=box, width=6.2, height=0.01, style=invis];
  fsrc [label="文件数据源\n(TDMS/日志)\n(101)"];
  nsrc [label="网络数据源\n(Kafka/TCP)\n(102)"];
  norm [label="数据标准化处理\n(110)"];

  layer_w2 [label="", shape=box, width=6.2, height=0.01, style=invis];
  mq [label="消息中间件主题\nshot-metadata\nwave-data\noperation-log\nplc-interlock\n(120)"];

  layer_w3 [label="", shape=box, width=6.2, height=0.01, style=invis];
  mysql [label="关系型数据库\n(MySQL/H2)\n(130)"];
  influx [label="时序数据库\n(InfluxDB)\n(131)"];

  layer_w4 [label="", shape=box, width=6.2, height=0.01, style=invis];
  api [label="服务接口模块\n(REST API)\n(140)"];
  ws  [label="实时推送模块\n(WebSocket)\n(141)"];
  ui  [label="可视化终端\n(150)"];

  {rank=same; l1; layer_w1; fsrc; nsrc; norm;}
  {rank=same; l2; layer_w2; mq;}
  {rank=same; l3; layer_w3; mysql; influx;}
  {rank=same; l4; layer_w4; api; ws; ui;}

  layer_w1 -> fsrc [style=invis];
  layer_w1 -> nsrc [style=invis];
  layer_w1 -> norm [style=invis];
  layer_w2 -> mq [style=invis];
  layer_w3 -> mysql [style=invis];
  layer_w3 -> influx [style=invis];
  layer_w4 -> api [style=invis];
  layer_w4 -> ws [style=invis];
  layer_w4 -> ui [style=invis];
  l1 -> l2 -> l3 -> l4 [style=invis, weight=30];

  fsrc -> norm;
  nsrc -> norm;

  norm -> mq;
  mq -> mysql;
  mq -> influx;
  mysql -> api;
  influx -> api;
  api -> ws;
  ws -> ui;

  legend [shape=box, style=solid, penwidth=2.0, fontsize=12,
          label="附图标记说明\l101 文件数据源\l102 网络数据源\l110 标准化处理\l120 消息中间件\l130 关系型数据库\l131 时序数据库\l140 服务接口\l141 实时推送\l150 可视化终端\l"];
}
